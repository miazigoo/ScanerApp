<LoginScreen>:
    name: "login"
    MDBoxLayout:
        orientation: 'vertical'
        spacing: dp(16)
        md_bg_color: app.theme_cls.bg_normal

        MDTopAppBar:
            title: "Авторизация"
            md_bg_color: app.theme_cls.primary_color
        
        Widget:
            size_hint_y: None
            height: dp(24)

        MDCard:
            orientation: 'vertical'
            size_hint: None, None
            size: dp(400), self.minimum_height
            pos_hint: {"center_x": .5}
            elevation: 8
            padding: dp(24)
            spacing: dp(24)

            MDLabel:
                text: "Вход в систему"
                halign: "center"
                font_style: "H5"
                theme_text_color: "Primary"

            # --- КНОПКИ ВЫБОРА РЕЖИМА ---
            MDBoxLayout:
                orientation: "horizontal"
                spacing: dp(8)
                size_hint_y: None
                height: dp(36)
                MDRaisedButton:
                    id: btn_login
                    text: "Логин/Пароль"
                    on_release: root.set_mode("Логин/Пароль")
                    md_bg_color: app.theme_cls.primary_color if root.ids.login_fields.opacity==1 else app.theme_cls.primary_light
                MDRaisedButton:
                    id: btn_token
                    text: "По ШК"
                    on_release: root.set_mode("По ШК")
                    md_bg_color: app.theme_cls.primary_color if root.ids.token_fields.opacity==1 else app.theme_cls.primary_light

            # --- ПОЛЯ ДЛЯ ВВОДА ---
            MDBoxLayout:
                id: login_fields
                orientation: "vertical"
                spacing: dp(12)
                opacity: 1
                disabled: False
                size_hint_y: None
                height: dp(120)
                MDTextField:
                    id: username
                    hint_text: "Имя пользователя"
                    icon_right: "account"
                    helper_text_mode: "on_error"
                    pos_hint: {"center_x": .5}
                    mode: "rectangle"
                    size_hint_x: 1
                    focus: False
                MDTextField:
                    id: password
                    hint_text: "Пароль"
                    password: True
                    icon_right: "lock"
                    mode: "rectangle"
                    pos_hint: {"center_x": .5}
                    size_hint_x: 1

            MDBoxLayout:
                id: token_fields
                orientation: "vertical"
                spacing: dp(12)
                opacity: 0
                disabled: True
                size_hint_y: None
                height: dp(56)
                MDTextField:
                    id: token
                    hint_text: "Вставьте или сканируйте токен"
                    icon_right: "barcode"
                    mode: "rectangle"
                    pos_hint: {"center_x": .5}
                    size_hint_x: 1
                    on_text: root.on_token_text(self.text)
                    focus: False

            MDLabel:
                id: error_label
                text: ""
                halign: "center"
                theme_text_color: "Error"
                font_style: "Subtitle2"
                size_hint_y: None
                height: self.texture_size[1]

            # --- КНОПКИ ВОЙТИ ---
            MDBoxLayout:
                id: login_button_box
                orientation: "horizontal"
                spacing: dp(16)
                size_hint_y: None
                height: dp(44)
                opacity: 1
                disabled: False
                MDRaisedButton:
                    text: "Войти"
                    icon: "login"
                    md_bg_color: app.theme_cls.primary_color
                    on_release: root.login()

            MDBoxLayout:
                id: token_button_box
                orientation: "horizontal"
                spacing: dp(16)
                size_hint_y: None
                height: dp(44)
                opacity: 0
                disabled: True
                MDRaisedButton:
                    text: "Войти"
                    icon: "barcode"
                    md_bg_color: app.theme_cls.primary_color
                    on_release: root.login_token()

            # Кнопка "Войти" для логин/пароль
            # MDBoxLayout:
            #     id: login_button_box
            #     orientation: "horizontal"
            #     spacing: dp(16)
            #     size_hint_y: None
            #     height: dp(44)
            #     opacity: 1
            #     disabled: False
            #     MDRaisedButton:
            #         text: "Войти"
            #         icon: "login"
            #         md_bg_color: app.theme_cls.primary_color
            #         on_release: root.login()

            # # Кнопка "Войти" для ШК
            # MDBoxLayout:
            #     id: token_button_box
            #     orientation: "horizontal"
            #     spacing: dp(16)
            #     size_hint_y: None
            #     height: dp(44)
            #     opacity: 0
            #     disabled: True
            #     MDRaisedButton:
            #         text: "Войти"
            #         icon: "barcode"
            #         md_bg_color: app.theme_cls.primary_color
            #         on_release:
            #             root.login_token()
