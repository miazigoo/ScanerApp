<BarcodeListScreen@Screen>:
    name: "history"
    MDBoxLayout:
        orientation: 'vertical'
        padding: 0
        spacing: 0

        MDTopAppBar:
            title: "История штрих-кодов"
            md_bg_color: app.theme_cls.primary_color
            elevation: 10
            size_hint_y: None
            height: dp(56)
            left_action_items: [["arrow-left", lambda x: setattr(app.root, "current", "main")]]

        ScrollView:
            size_hint: (1, 1)
            bar_width: dp(10)
            bar_color: app.theme_cls.primary_color

            MDBoxLayout:
                orientation: 'vertical'
                size_hint_y: None
                height: self.minimum_height
                padding: dp(16)
                spacing: dp(16)

                # Блок информации о фильтрах и неотправленных данных
                MDBoxLayout:
                    orientation: 'vertical'
                    size_hint_y: None
                    height: dp(60)  # Фиксированная высота или можно сделать динамической
                    spacing: dp(8)

                    MDLabel:
                        id: order_filter_label
                        text: "Фильтр: все заказы"
                        size_hint_y: None
                        height: dp(30)
                        halign: 'center'
                        font_style: 'Subtitle1'

                    MDLabel:
                        id: unsynced_info
                        text: ""
                        size_hint_y: None
                        height: self.texture_size[1] if self.text else 0
                        halign: 'center'
                        font_style: 'Body2'
                        theme_text_color: "Error"

                # Список штрих-кодов
                RecycleView:
                    id: barcode_rv
                    viewclass: "BarcodeItem"
                    size_hint_y: None
                    height: 500
                    
                    RecycleBoxLayout:
                        orientation: 'vertical'
                        default_size: (None, dp(56))
                        default_size_hint: (1, None)
                        size_hint_y: None
                        height: self.minimum_height
                        spacing: dp(8)

        # Панель кнопок (остается фиксированной внизу)
        MDBoxLayout:
            orientation: 'horizontal'
            size_hint_y: None
            height: dp(56)
            spacing: dp(12)
            padding: dp(10)

            MDRaisedButton:
                text: "Синхронизировать"
                icon: "sync"
                on_release: root.sync_all()

            MDRaisedButton:
                text: "Экспорт в JSON"
                icon: "file-export"
                on_release: root.export_json()
            
            MDRaisedButton:
                text: "Очистить историю"
                icon: "trash-can"
                on_release: root.clear_history()
                md_bg_color: app.theme_cls.error_color

            MDRaisedButton:
                text: "Назад"
                icon: "arrow-left"
                on_release: app.root.current = "main"


<BarcodeItem@MDCard>:
    id: 0
    code: ''
    is_sent: False
    created_at: ''
    error_count: 0
    orientation: 'horizontal'
    size_hint_y: None
    height: dp(48)
    padding: dp(4)
    spacing: dp(8)
    elevation: 2
    radius: [dp(4),]
    md_bg_color: (0.7, 1, 0.7, 1) if root.is_sent else (1, 0.7, 0.7, 1)
    on_touch_down:
        if self.collide_point(*args[1].pos): app.root.get_screen('history').on_barcode_item_click(self)
    
    MDLabel:
        text: str(root.id)
        size_hint_x: 0.1
        halign: 'center'
        text_color: app.theme_cls.primary_color
        color: ('black')
        bold: True
    
    MDLabel:
        text: root.code
        size_hint_x: 0.35
        halign: 'center'
        text_color: app.theme_cls.primary_color
        color: ('black')
    
    BoxLayout:
        size_hint_x: 0.1
        halign: 'center'
        MDIcon:
            icon: "check-circle" if root.is_sent else "alert-circle-outline"
            theme_text_color: "Custom"
            text_color: (0, 0.7, 0, 1) if root.is_sent else (1, 0.2, 0.2, 1)
            font_size: '24sp'
            halign: 'center'
    
    MDLabel:
        text: root.created_at
        size_hint_x: 0.25
        halign: 'center'
        text_color: app.theme_cls.primary_color
        color: ('black')
        font_size: '12sp'
    
    MDLabel:
        text: f"Ошибок: {root.error_count}"
        size_hint_x: 0.2
        halign: 'center'
        text_color: app.theme_cls.primary_color
        color: ('black')